---
phase: 06-ipc-server
plan: 02
type: execute
depends_on: ["06-01"]
files_modified: [Exmen.xcodeproj/project.pbxproj, exmen-cli/main.swift]
---

<objective>
Create CLI tool that communicates with Exmen via Unix socket.

Purpose: Provide command-line interface for external tools and scripts.
Output: `exmen` executable that can list-actions, run, and status.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-ipc-server/06-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add CLI target to Xcode project</name>
  <files>Exmen.xcodeproj/project.pbxproj</files>
  <action>
  Add new command-line tool target to the Xcode project:
  1. Target name: exmen-cli
  2. Product name: exmen
  3. Type: Command Line Tool (macOS)
  4. Language: Swift
  5. Create directory: exmen-cli/

  Can use xcodebuild or manually edit project.pbxproj, or use:
  ```
  mkdir -p exmen-cli
  # Then add target via Xcode project file manipulation
  ```

  The simpler approach: Create a standalone Swift file that compiles with swiftc.
  For now, create exmen-cli/main.swift and build with: swiftc -o exmen exmen-cli/main.swift
  </action>
  <verify>exmen-cli/main.swift exists</verify>
  <done>CLI source file created</done>
</task>

<task type="auto">
  <name>Task 2: Implement CLI socket client</name>
  <files>exmen-cli/main.swift</files>
  <action>
  Implement CLI that:
  1. Parses command line arguments (using CommandLine.arguments)
  2. Connects to Unix socket at ~/.config/exmen/exmen.sock
  3. Sends JSON command based on args
  4. Reads and prints response

  Usage:
  - `exmen list-actions` → {"command": "list-actions"}
  - `exmen run "Action Name"` → {"command": "run", "name": "Action Name"}
  - `exmen status "Action Name"` → {"command": "status", "name": "Action Name"}

  Handle errors:
  - Socket not found → "Exmen is not running"
  - Connection refused → "Could not connect to Exmen"
  - Invalid response → Show raw response

  Output formatting:
  - list-actions: Pretty print action names, one per line (or JSON with --json flag)
  - run: Print the action output
  - status: Print status info

  Use Darwin socket APIs (same as server side, but connect() instead of bind/listen).
  </action>
  <verify>swiftc -o exmen exmen-cli/main.swift compiles successfully</verify>
  <done>CLI compiles and handles list-actions, run, status commands</done>
</task>

<task type="auto">
  <name>Task 3: Build and install CLI</name>
  <files>Makefile or build script</files>
  <action>
  1. Build CLI: swiftc -O -o .build/exmen exmen-cli/main.swift
  2. Test commands work:
     - .build/exmen list-actions
     - .build/exmen run "Generate Phone Number" (if that action exists)
     - .build/exmen status "System Status" (if that action exists)
  3. Optionally add build instructions to README

  Note: User can install to PATH with: cp .build/exmen /usr/local/bin/
  </action>
  <verify>
  1. .build/exmen list-actions returns action list
  2. .build/exmen run "..." executes action
  </verify>
  <done>CLI built and working end-to-end</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] CLI compiles without errors
- [ ] `exmen list-actions` shows available actions
- [ ] `exmen run "Action Name"` executes action and shows output
- [ ] `exmen status "Action Name"` shows action status
- [ ] Error handling works (Exmen not running → helpful message)
</verification>

<success_criteria>

- All tasks completed
- CLI communicates with Exmen app via socket
- Commands work as expected
- Ready for integration with tools like sketchybar
  </success_criteria>

<output>
After completion, create `.planning/phases/06-ipc-server/06-02-SUMMARY.md`
</output>
