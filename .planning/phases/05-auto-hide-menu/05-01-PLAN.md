---
phase: 05-auto-hide-menu
plan: 01
type: execute
depends_on: []
files_modified: [Exmen/Models/ActionConfig.swift, Exmen/Models/Action.swift, Exmen/Views/MenuContentView.swift]
---

<objective>
Hide menu popup when action is clicked, with per-action override option.

Purpose: Improve UX by auto-dismissing menu after action execution (clipboard/notification handlers). Actions that show popup results keep menu open.
Output: Menu dismisses on click by default, configurable via `hide_on_click` in TOML.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@Exmen/Models/ActionConfig.swift
@Exmen/Models/Action.swift
@Exmen/Views/MenuContentView.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add hide_on_click config option</name>
  <files>Exmen/Models/ActionConfig.swift, Exmen/Models/Action.swift</files>
  <action>
  1. In ActionConfig.swift, add `hide_on_click: Bool?` field to ActionConfig struct
  2. Add computed property `resolvedHideOnClick` that returns `hide_on_click ?? true` (default true)
  3. In Action.swift, add `hideOnClick: Bool` property
  4. Update Action initializer to accept hideOnClick parameter
  5. Update ActionService where Action is created from ActionConfig to pass `config.resolvedHideOnClick`
  </action>
  <verify>Build succeeds: xcodebuild -project Exmen.xcodeproj -scheme Exmen build 2>&1 | grep -E "(BUILD|error:)"</verify>
  <done>ActionConfig has hide_on_click field, Action has hideOnClick property, defaults to true</done>
</task>

<task type="auto">
  <name>Task 2: Implement menu dismissal on action click</name>
  <files>Exmen/Views/MenuContentView.swift</files>
  <action>
  1. In executeAction(), after starting the task, check if action.hideOnClick is true AND action.outputConfig.handler is NOT .popup
  2. If both conditions met, dismiss the menu using: NSApp.keyWindow?.close()
  3. For popup handler, menu stays open to show results (existing behavior)
  4. Add @Environment(\.dismiss) if needed, or use NSApp.keyWindow?.close() directly
  </action>
  <verify>
  1. Run app, click action with clipboard handler → menu closes
  2. Click action with popup handler → menu stays open, shows result
  3. Add hide_on_click = false to a test action → menu stays open on click
  </verify>
  <done>Menu closes on action click by default, stays open for popup handler or when hide_on_click = false</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] Build succeeds without errors
- [ ] Default behavior: menu closes on action click (clipboard/notification)
- [ ] Popup handler: menu stays open to show results
- [ ] Override: `hide_on_click = false` in TOML keeps menu open
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- Menu dismissal works correctly for all output handlers
- Per-action override via TOML config works
  </success_criteria>

<output>
After completion, create `.planning/phases/05-auto-hide-menu/05-01-SUMMARY.md`:

# Phase 5 Plan 01: Auto-Hide Menu Summary

**[Substantive one-liner]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `path/to/file.ts` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

[Phase complete or next plan]
</output>
